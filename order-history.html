<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order History | Online Food App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: url('https://images.unsplash.com/photo-1514517382848-9780df7b2a2d') no-repeat center center fixed;
      background-size: cover;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 10px;
      color: #ffd700;
      margin-bottom: 20px;
    }

    #success-msg {
      background-color: rgba(0, 255, 0, 0.7);
      color: black;
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: bold;
      display: none;
    }

    #order-history {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .order {
      background: rgba(0, 0, 0, 0.75);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      transition: transform 0.2s ease;
    }

    .order:hover {
      transform: scale(1.02);
    }

    .order h2 {
      color: #ffdd57;
      margin-bottom: 15px;
    }

    .order p {
      margin: 6px 0;
      font-size: 1rem;
    }

    .order-total {
      margin-top: 15px;
      font-weight: bold;
      color: #00ffc8;
      font-size: 1.1rem;
    }

    .order-user {
      margin-bottom: 10px;
      color: #00bfff;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      .order {
        padding: 15px;
      }

      h1 {
        font-size: 1.5rem;
      }
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>Your Order History</h1>
  <div id="success-msg">ðŸŽ‰ Your food has been ordered successfully!</div>
  <div id="order-history"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDWoalk1LmrdNdngG_jCA2wzDu0_rxR6Oc",
      authDomain: "web-b43.firebaseapp.com",
      databaseURL: "https://web-b43-default-rtdb.firebaseio.com",
      projectId: "web-b43",
      storageBucket: "web-b43.appspot.com",
      messagingSenderId: "1043699448922",
      appId: "1:1043699448922:web:75aca8f58416f651e4ec63",
    };

    firebase.initializeApp(firebaseConfig);

    const dbRef = firebase.database().ref("orders");
    const orderHistoryEl = document.getElementById("order-history");
    const successMsg = document.getElementById("success-msg");

    // Show success message for 3 seconds
    successMsg.style.display = "block";
    setTimeout(() => {
      successMsg.style.display = "none";
    }, 3000);

    dbRef.once("value", snapshot => {
      const data = snapshot.val();

      if (!data) {
        orderHistoryEl.innerHTML = "<p style='color: white; text-align: center;'>No past orders found.</p>";
        return;
      }

      const orders = Object.values(data);

      orders.forEach((order, index) => {
        const orderDiv = document.createElement("div");
        orderDiv.className = "order";

        let total = 0;

        const itemsHTML = order.items.map(item => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;
          return `<p>${item.name} Ã— ${item.quantity} = â‚¹${itemTotal}</p>`;
        }).join("");

        orderDiv.innerHTML = `
          <h2>Order #${index + 1}</h2>
          <p class="order-user">ðŸ‘¤ Name: ${order.username || "Guest"}</p>
          ${itemsHTML}
          <p class="order-total">Total Bill: â‚¹${total}</p>
        `;

        orderHistoryEl.appendChild(orderDiv);
      });
    });
  </script>
</body>
</html>
